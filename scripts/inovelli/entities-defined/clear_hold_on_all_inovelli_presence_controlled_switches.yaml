alias: Clear hold on all Inovelli Presence Controlled Switches
description: >
  Clears hold on all configured Inovelli presence-controlled switches and
  restores LED indicators.
sequence:
  - variables:
      default_normal_mode: Occupancy (default)
      hold_color: input_text.inovelli_auto_hold
      switches:
        - switch_name: basement_server_inovelli_presence
          helper: input_text.basement_server_led_color
          normal_mode_input_select: input_select.basement_server_room_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_fp2_server_room_motion_detected_lights_on
            - automation.light_fp2_server_room_motion_cleared_lights_off
        - switch_name: basement_upper_staircase_inovelli_presence
          helper: input_text.basement_upper_staircase_led_color
          normal_mode_input_select: input_select.basement_staircase_mmwave_normal_mode
        - switch_name: basement_lower_staircase_inovelli_presence
          helper: input_text.basement_lower_staircase_led_color
          normal_mode_input_select: input_select.basement_staircase_mmwave_normal_mode
        - switch_name: basement_bathroom_vanity_inovelli_presence
          helper: input_text.basement_bathroom_vanity_led_color
          normal_mode_input_select: input_select.basement_bathroom_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_inovelli_basement_bathroom_motion_detected_fan_light_on
            - automation.light_inovelli_basement_bathroom_motion_cleared_fan_light_off
        - switch_name: basement_movie_inovelli_presence
          helper: input_text.basement_movie_led_color
          normal_mode_input_select: input_select.basement_movie_room_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_inovelli_movie_room_motion_cleared_lights_off
        - switch_name: basement_concessions_inovelli_presence
          helper: input_text.basement_concessions_led_color
          normal_mode_input_select: input_select.basement_concessions_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_zse11_concessions_motion_detected_lights_on
            - automation.light_zse11_concessions_motion_cleared_lights_off
        - switch_name: basement_hallway_inovelli_presence
          helper: input_text.basement_hallway_led_color
          normal_mode_input_select: input_select.basement_hallway_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_zse11_basement_hallway_motion_detected_lights_on
            - automation.light_zse11_basement_hallway_motion_cleared_lights_off
        - switch_name: basement_rumpus_room_inovelli_presence
          helper: input_text.basement_rumpus_room_led_color
          normal_mode_input_select: input_select.basement_rumpus_room_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_snzb_06p_rumpus_room_motion_detected_lights_on
            - automation.light_snzb_06p_rumpus_room_motion_cleared_lights_off
        - switch_name: downstairs_bathroom_vanity_inovelli_presence
          helper: input_text.downstairs_bathroom_vanity_led_color
          normal_mode_input_select: input_select.downstairs_bathroom_vanity_mmwave_normal_mode
        - switch_name: downstairs_mudroom_inovelli_presence
          helper: input_text.downstairs_mudroom_led_color
          normal_mode_input_select: input_select.downstairs_mudroom_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_inovelli_downstairs_mudroom_motion_detected_lights_on
            - automation.light_inovelli_downstairs_mudroom_motion_cleared_lights_off
        - switch_name: garage_interior_mudroom_inovelli_presence
          helper: input_text.garage_mudroom_door_led_color
          normal_mode_input_select: input_select.garage_interior_mudroom_mmwave_normal_mode
        - switch_name: upstairs_kids_bathroom_vanity_inovelli_presence
          helper: input_text.upstairs_kids_vanity_led_color
          normal_mode_input_select: input_select.upstairs_kids_bathroom_vanity_mmwave_normal_mode
        - switch_name: upstairs_laundry_inovlli_presence
          helper: input_text.upstairs_laundry_led_color
          normal_mode_input_select: input_select.upstairs_laundry_mmwave_normal_mode
        - switch_name: upstairs_primary_closet_inovelli_presence
          helper: input_text.upstairs_primary_closet_led_color
          normal_mode_input_select: input_select.upstairs_primary_closet_mmwave_normal_mode
          automation_entity_ids:
            - automation.light_zse41_primary_closet_door_open_turn_on
            - automation.light_zse41_primary_closet_door_closed_turn_off
        - switch_name: upstairs_primary_bath_vanity_inovelli_presence
          helper: input_text.upstairs_primary_vanity_led_color
          automation_entity_ids:
            - >-
              automation.light_inovelli_primary_bathroom_motion_cleared_lights_off
          normal_mode_input_select: input_select.upstairs_primary_bathroom_vanity_mmwave_normal_mode
        - switch_name: upstairs_primary_bath_shower_inovelli_presence
          helper: input_text.upstairs_primary_shower_led_color
          automation_entity_ids:
            - >-
              automation.light_inovelli_primary_bathroom_motion_cleared_lights_off
          normal_mode_input_select: input_select.upstairs_primary_bathroom_shower_mmwave_normal_mode
        - switch_name: upstairs_primary_water_closet_inovelli_presence
          helper: input_text.upstairs_primary_water_closet_led_color
          normal_mode_input_select: input_select.upstairs_primary_water_closet_mmwave_normal_mode
  - repeat:
      for_each: "{{ switches }}"
      sequence:
        - choose:
            - conditions:
                - condition: template
                  value_template: >-
                    {% set e = repeat.item.normal_mode_input_select | default('') | string %}
                    {{ e.startswith('input_select.') }}
              sequence:
                - action: script.inovelli_clear_mmwave_hold_restore_led_indicator
                  data:
                    switch_name: "{{ repeat.item.switch_name }}"
                    normal_mode_input_select: "{{ repeat.item.normal_mode_input_select }}"
                    hold_color: "{{ hold_color }}"
                    prev_led_color_helper: "{{ repeat.item.helper }}"
                    automation_entity_ids: "{{ repeat.item.automation_entity_ids | default([]) }}"
          default:
            - action: script.inovelli_clear_mmwave_hold_restore_led_indicator
              data:
                switch_name: "{{ repeat.item.switch_name }}"
                normal_mode: "{{ repeat.item.normal_mode | default(default_normal_mode) }}"
                hold_color: "{{ hold_color }}"
                prev_led_color_helper: "{{ repeat.item.helper }}"
                automation_entity_ids: "{{ repeat.item.automation_entity_ids | default([]) }}"
        - delay:
            seconds: 2
mode: single
